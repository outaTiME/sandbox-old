/*!
*              __     _
*   _    _/__  /./|,//_`
*  /_//_// /_|///  //_, v.0.9.14
*
* Copyright (c) 2012 outaTiME, Inc.
*/
function initialize(e){function l(){$("#home #box .overlay").show()}function c(){$("#home #box .overlay").hide()}function h(e,n){var r=t;e=e||t||"section#place_locator",n=n||$.noop,$(e).css({visibility:"visible"}),$(".tab-pane.active").scrollTo(e,400,{easing:"easeOutExpo",onAfter:function(){n(),r&&r!==e&&$(r).css({visibility:"hidden"})}}),t=e}function p(e,t){e.removeClass("in"),e.removeClass("out"),t===!0?e.addClass("in"):e.addClass("out")}function d(e){e.length===0?$("section#welcome").show():S()}function v(e){var t=$("section#"+e+" .page-header span"),n=$("section#"+e+" div.page-header").outerWidth()-$("section#"+e+" div.page-header i").outerWidth()-$("section#"+e+" div.page-header button").outerWidth()-9-18;t.width(n)}function m(e){var t=[];i=new google.maps.LatLngBounds;for(var n=0;n<e.getLength();n++){var r=e.getAt(n);i.extend(r),t.push(r)}u.setPath(t),f=!0}function g(e){e=e||new google.maps.Polygon({paths:a,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,editable:!0}),e.setMap(o),google.maps.event.addListener(e.getPath(),"insert_at",function(e){m(this)}),google.maps.event.addListener(e.getPath(),"remove_at",function(e){m(this)}),google.maps.event.addListener(e.getPath(),"set_at",function(e){m(this)}),google.maps.event.addListener(e,"rightclick",function(t){t.vertex!==null&&e.getPath().removeAt(t.vertex)})}function y(e){var t=!!e,n=t?new google.maps.LatLng(e.coords.latitude,e.coords.longitude):i.getCenter();o=new google.maps.Map(document.getElementById("map-bounds"),{zoom:10,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,zoomControl:!0});var r={strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,editable:!0},s=new google.maps.drawing.DrawingManager({drawingControl:!1,drawingControlOptions:{drawingModes:[google.maps.drawing.OverlayType.POLYGON]},polylineOptions:{editable:!0},polygonOptions:r,map:o});if(t){s.setOptions({drawingMode:google.maps.drawing.OverlayType.POLYGON});var u=google.maps.event.addListener(s,"polygoncomplete",function(e){g(e),s.setOptions({drawingMode:null}),google.maps.event.removeListener(u),m(e.getPath()),o.fitBounds(i),$("section#welcome").hide()})}else g(),o.fitBounds(i)}function b(e){l();var t=[],n=u.getPath();for(var r=0;r<n.getLength();r++){var i=n.getAt(r);t.push({lat:i.lat(),lng:i.lng()})}$.ajax({type:"POST",url:"/inout/bounds",dataType:"json",data:{bounds:[{points:t}]},error:function(e,t){},success:function(e,t,n){},complete:function(t,n){setTimeout(function(){$.isFunction(e)&&e(),c()},1e3)}})}function w(e,t,n,r){$.ajax({type:"POST",url:"/log",dataType:"json",data:{module:"inout",verb:e,action:t,query:JSON.stringify(n),result:JSON.stringify(r)},error:function(e,t){},success:function(e,t,n){},complete:function(e,t){}})}function E(){h("section#welcome")}function S(e){h("section#place_locator",function(){e!==!1&&$("form#search :input:visible:enabled:first").select().focus()})}google.maps.Polygon.prototype.getBounds||(google.maps.Polygon.prototype.getBounds=function(e){var t=new google.maps.LatLngBounds,n=this.getPaths(),r;for(var i=0;i<n.getLength();i++){r=n.getAt(i);for(var s=0;s<r.getLength();s++)t.extend(r.getAt(s))}return t}),google.maps.Polygon.prototype.containsLatLng=function(e){var t=this.getBounds();if(t!==null&&!t.contains(e))return!1;var n=!1,r=this.getPaths().getLength();for(var i=0;i<r;i++){var s=this.getPaths().getAt(i),o=s.getLength(),u=o-1;for(var a=0;a<o;a++){var f=s.getAt(a),l=s.getAt(u);(f.lng()<e.lng()&&l.lng()>=e.lng()||l.lng()<e.lng()&&f.lng()>=e.lng())&&f.lat()+(e.lng()-f.lng())/(l.lng()-f.lng())*(l.lat()-f.lat())<e.lat()&&(n=!n),u=a}}return n};var t,n=!1,r,i=new google.maps.LatLngBounds,s,o,u,a=[],f=!1;(function(){$("#home form#search").submit(function(e){var t=!1;$("form .control-group").removeClass("error"),e.preventDefault(),l(),$("form#search :input:visible:enabled:first").blur();var n=$("form .area"),o=$("form button"),a=$("#search #keywords"),f=new google.maps.Geocoder,d={address:a.val(),bounds:i};f.geocode(d,function(e,n){w("GET","address",d,e);if(n===google.maps.GeocoderStatus.OK){var o=e;for(var a=0;a<o.length;a++){var f=o[a],l=f.types[0],v=f.geometry.location,m=new google.maps.LatLng(v.lat(),v.lng()),g=$("section#view .page-header i"),y=$("section#view .page-header span"),b=$("section#view #map"),E=$(".map-container");r?r.setPosition(m):r=new google.maps.Marker({position:m,map:s,clickable:!1}),y.text(f.formatted_address);var S=u.containsLatLng(m);p(g,S),p(y,S),p(b,S),$(".inside, .outside",E).hide();if(S)s.setCenter(m),s.setZoom(16),$(".inside",E).show();else{var x=new google.maps.LatLngBounds(i.getSouthWest(),i.getNorthEast());x.extend(m);var T=google.maps.geometry.spherical.computeDistanceBetween(i.getCenter(),m)/1e3,N=$(".outside",E);$("p.small",N).text(T.toFixed(1)+"kms away"),N.show(),T>1500?(s.setZoom(6),s.setCenter(m)):(s.fitBounds(x),s.setCenter(m))}c(),h("section#view"),t=!0;break}}t===!1&&(c(),$("form .control-group").addClass("error"),$("form#search :input:visible:enabled:first").select().focus())})}),$("body").on("click","#btn-welcome",function(e){$(".nav-tabs a[href='#2']").trigger("click")}),$("body").on("click","#btn-back",function(e){var t=u.getPath();!t||t.getLength()===0?E():S()}),$("body").on("click","#btn-save",function(e){b()}),$("body").on("click","#btn-done",function(e){b(function(){$("section#welcome").hide(),S()})}),$("body").on("click",".nav-tabs a[data-toggle='tab']",function(e){var r=$(this).attr("href"),i=$("form .area"),u=$("form button"),l=$("#search #keywords");r==="#2"?(n===!1&&($("#map-bounds").height($("#2").outerHeight()-4),n=!0,a.length===0?navigator.geolocation.watchPosition(function(e){y(e)}):y()),o&&google.maps.event.trigger(o,"resize")):(google.maps.event.trigger(s,"resize"),$("section#welcome").is(":hidden")&&(f===!0||t!=="section#view")&&(S(),f=!1))}),$("body").on("click","a#profile",function(e){$("div.tabbable").hide(),$("div#profile").show(),$("form#profile :input:visible:enabled:first").select().focus(),$("#home form#profile :input").val("")}),$("body").on("click","#home form#profile button#cancel",function(e){$("div#profile").hide(),$("div.tabbable").show(),t==="section#place_locator"&&$("form#search :input:visible:enabled:first").select().focus(),$("#home form#profile :input").val("")}),$("#home form#profile").submit(function(e){e.preventDefault(),l(),$("form#profile").blur(),$.ajax({type:"POST",url:"/profile",dataType:"json",data:{pass_old:$("#home form#profile #pass_old").val(),pass_new:$("#home form#profile #pass_new").val(),pass_retry:$("#home form#profile #pass_retry").val()},error:function(e,t){$("form#profile :input:visible:enabled:first").select().focus()},success:function(e,n,r){$("div#profile").hide(),$("div.tabbable").show(),t==="section#place_locator"&&$("form#search :input:visible:enabled:first").select().focus(),$("#home form#profile :input").val("")},complete:function(e,t){c()}})})})(),function(){v("view"),$(window).resize(function(){$.doTimeout("resize",250,function(){v("view")})}),$("#map").height($("#1").outerHeight()-$("section#view .page-header").outerHeight()-18-6);var t=e;if(t.length>0){var n=t[0].points;if(n.length>0)for(var r=0;r<n.length;r++){var s=n[r],o=new google.maps.LatLng(s.lat,s.lng);a.push(o),i.extend(o)}}}(),function(){s=new google.maps.Map(document.getElementById("map"),{zoom:16,center:i.getCenter(),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,zoomControl:!0,minZoom:4}),google.maps.event.addListenerOnce(s,"idle",function(){d(a),c()}),u=new google.maps.Polygon({paths:a||[],strokeColor:"#0000FF",strokeOpacity:.6,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.15,clickable:!1}),u.setMap(s)}()}jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,r,i){return jQuery.easing[jQuery.easing.def](e,t,n,r,i)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;o||(o=i*.3*1.5);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),(t/=i/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+n:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,i){return r-jQuery.easing.easeOutBounce(e,i-t,0,r,i)+n},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,r,i){return t<i/2?jQuery.easing.easeInBounce(e,t*2,0,r,i)*.5+n:jQuery.easing.easeOutBounce(e,t*2-i,0,r,i)*.5+r*.5+n}}),function(e){function n(e){return typeof e=="object"?e:{top:e,left:e}}var t=e.scrollTo=function(t,n,r){e(window).scrollTo(t,n,r)};t.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1,limit:!0},t.window=function(t){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){var t=this,n=!t.nodeName||e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!n)return t;var r=(t.contentWindow||t).document||t.ownerDocument||t;return/webkit/i.test(navigator.userAgent)||r.compatMode=="BackCompat"?r.body:r.documentElement})},e.fn.scrollTo=function(r,i,s){return typeof i=="object"&&(s=i,i=0),typeof s=="function"&&(s={onAfter:s}),r=="max"&&(r=9e9),s=e.extend({},t.defaults,s),i=i||s.duration,s.queue=s.queue&&s.axis.length>1,s.queue&&(i/=2),s.offset=n(s.offset),s.over=n(s.over),this._scrollable().each(function(){function d(e){u.animate(c,i,s.easing,e&&function(){e.call(this,r,s)})}if(!r)return;var o=this,u=e(o),a=r,l,c={},p=u.is("html,body");switch(typeof a){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(a)){a=n(a);break}a=e(a,this);if(!a.length)return;case"object":if(a.is||a.style)l=(a=e(a)).offset()}e.each(s.axis.split(""),function(e,n){var r=n=="x"?"Left":"Top",i=r.toLowerCase(),f="scroll"+r,v=o[f],m=t.max(o,n);if(l)c[f]=l[i]+(p?0:v-u.offset()[i]),s.margin&&(c[f]-=parseInt(a.css("margin"+r))||0,c[f]-=parseInt(a.css("border"+r+"Width"))||0),c[f]+=s.offset[i]||0,s.over[i]&&(c[f]+=a[n=="x"?"width":"height"]()*s.over[i]);else{var y=a[i];c[f]=y.slice&&y.slice(-1)=="%"?parseFloat(y)/100*m:y}s.limit&&/^\d+$/.test(c[f])&&(c[f]=c[f]<=0?0:Math.min(c[f],m)),!e&&s.queue&&(v!=c[f]&&d(s.onAfterFirst),delete c[f])}),d(s.onAfter)}).end()},t.max=function(t,n){var r=n=="x"?"Width":"Height",i="scroll"+r;if(!e(t).is("html,body"))return t[i]-e(t)[r.toLowerCase()]();var s="client"+r,o=t.ownerDocument.documentElement,u=t.ownerDocument.body;return Math.max(o[i],u[i])-Math.min(o[s],u[s])}}(jQuery),function(e){if(e)return;var t;e=window.navigator.geolocation={},e.getCurrentPosition=function(e){t&&e(t),$.getScript("//www.google.com/jsapi",function(){google.loader.ClientLocation&&(t={coords:{latitude:google.loader.ClientLocation.latitude,longitude:google.loader.ClientLocation.longitude}}),e(t)})},e.watchPosition=e.getCurrentPosition}(navigator.geolocation);