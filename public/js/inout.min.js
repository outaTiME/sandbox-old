/*!
*              __     _
*   _    _/__  /./|,//_`
*  /_//_// /_|///  //_, v.0.9.11
*
* Copyright (c) 2012 outaTiME, Inc.
*/
function initialize(a){function k(){$("#home #box .overlay").show()}function l(){$("#home #box .overlay").hide()}function m(a,c){var d=b;a=a||b||"section#place_locator",c=c||$.noop,$(a).css({visibility:"visible"}),$(".tab-pane.active").scrollTo(a,400,{easing:"easeOutExpo",onAfter:function(){c(),d&&d!==a&&$(d).css({visibility:"hidden"})}}),b=a}function n(a,b){a.removeClass("in"),a.removeClass("out"),b===!0?a.addClass("in"):a.addClass("out")}function o(a){a.length===0?$("section#welcome").show():w()}function p(a){var b=$("section#"+a+" .page-header span"),c=$("section#"+a+" div.page-header").outerWidth()-$("section#"+a+" div.page-header i").outerWidth()-$("section#"+a+" div.page-header button").outerWidth()-9-18;b.width(c)}function q(a){var b=[];e=new google.maps.LatLngBounds;for(var c=0;c<a.getLength();c++){var d=a.getAt(c);e.extend(d),b.push(d)}h.setPath(b),j=!0}function r(a){a=a||new google.maps.Polygon({paths:i,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,editable:!0}),a.setMap(g),google.maps.event.addListener(a.getPath(),"insert_at",function(a){q(this)}),google.maps.event.addListener(a.getPath(),"remove_at",function(a){q(this)}),google.maps.event.addListener(a.getPath(),"set_at",function(a){q(this)}),google.maps.event.addListener(a,"rightclick",function(b){b.vertex!==null&&a.getPath().removeAt(b.vertex)})}function s(a){var b=!!a,c=b?new google.maps.LatLng(a.coords.latitude,a.coords.longitude):e.getCenter();g=new google.maps.Map(document.getElementById("map-bounds"),{zoom:10,center:c,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,zoomControl:!0});var d={strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,editable:!0},f=new google.maps.drawing.DrawingManager({drawingControl:!1,drawingControlOptions:{drawingModes:[google.maps.drawing.OverlayType.POLYGON]},polylineOptions:{editable:!0},polygonOptions:d,map:g});if(b){f.setOptions({drawingMode:google.maps.drawing.OverlayType.POLYGON});var h=google.maps.event.addListener(f,"polygoncomplete",function(a){r(a),f.setOptions({drawingMode:null}),google.maps.event.removeListener(h),q(a.getPath()),g.fitBounds(e),$("section#welcome").hide()})}else r(),g.fitBounds(e)}function t(a){k();var b=[],c=h.getPath();for(var d=0;d<c.getLength();d++){var e=c.getAt(d);b.push({lat:e.lat(),lng:e.lng()})}$.ajax({type:"POST",url:"/inout/bounds",dataType:"json",data:{bounds:[{points:b}]},error:function(a,b){},success:function(a,b,c){},complete:function(b,c){setTimeout(function(){$.isFunction(a)&&a(),l()},1e3)}})}function u(a,b,c,d){$.ajax({type:"POST",url:"/log",dataType:"json",data:{module:"inout",verb:a,action:b,query:JSON.stringify(c),result:JSON.stringify(d)},error:function(a,b){},success:function(a,b,c){},complete:function(a,b){}})}function v(){m("section#welcome")}function w(a){m("section#place_locator",function(){a!==!1&&$("form#search :input:visible:enabled:first").select().focus()})}google.maps.Polygon.prototype.getBounds||(google.maps.Polygon.prototype.getBounds=function(a){var b=new google.maps.LatLngBounds,c=this.getPaths(),d;for(var e=0;e<c.getLength();e++){d=c.getAt(e);for(var f=0;f<d.getLength();f++)b.extend(d.getAt(f))}return b}),google.maps.Polygon.prototype.containsLatLng=function(a){var b=this.getBounds();if(b!==null&&!b.contains(a))return!1;var c=!1,d=this.getPaths().getLength();for(var e=0;e<d;e++){var f=this.getPaths().getAt(e),g=f.getLength(),h=g-1;for(var i=0;i<g;i++){var j=f.getAt(i),k=f.getAt(h);(j.lng()<a.lng()&&k.lng()>=a.lng()||k.lng()<a.lng()&&j.lng()>=a.lng())&&j.lat()+(a.lng()-j.lng())/(k.lng()-j.lng())*(k.lat()-j.lat())<a.lat()&&(c=!c),h=i}}return c};var b,c=!1,d,e=new google.maps.LatLngBounds,f,g,h,i=[],j=!1;(function(){$("#home form#search").submit(function(a){var b=!1;$("form .control-group").removeClass("error"),a.preventDefault(),k(),$("form#search :input:visible:enabled:first").blur();var c=$("form .area"),g=$("form button"),i=$("#search #keywords"),j=new google.maps.Geocoder,o={address:i.val(),bounds:e};j.geocode(o,function(a,c){u("GET","address",o,a);if(c===google.maps.GeocoderStatus.OK){var g=a;for(var i=0;i<g.length;i++){var j=g[i],k=j.types[0],p=j.geometry.location,q=new google.maps.LatLng(p.lat(),p.lng()),r=$("section#view .page-header i"),s=$("section#view .page-header span"),t=$("section#view #map"),v=$(".map-container");d?d.setPosition(q):d=new google.maps.Marker({position:q,map:f,clickable:!1}),s.text(j.formatted_address);var w=h.containsLatLng(q);n(r,w),n(s,w),n(t,w),$(".inside, .outside",v).hide();if(w)f.setCenter(q),f.setZoom(16),$(".inside",v).show();else{var x=new google.maps.LatLngBounds(e.getSouthWest(),e.getNorthEast());x.extend(q);var y=google.maps.geometry.spherical.computeDistanceBetween(e.getCenter(),q)/1e3,z=$(".outside",v);$("p.small",z).text(y.toFixed(1)+"kms away"),z.show(),y>1500?(f.setZoom(6),f.setCenter(q)):(f.fitBounds(x),f.setCenter(q))}l(),m("section#view"),b=!0;break}}b===!1&&(l(),$("form .control-group").addClass("error"),$("form#search :input:visible:enabled:first").select().focus())})}),$("body").on("click","#btn-welcome",function(a){$(".nav-tabs a[href='#2']").trigger("click")}),$("body").on("click","#btn-back",function(a){var b=h.getPath();!b||b.getLength()===0?v():w()}),$("body").on("click","#btn-save",function(a){t()}),$("body").on("click","#btn-done",function(a){t(function(){$("section#welcome").hide(),w()})}),$("body").on("click",".nav-tabs a[data-toggle='tab']",function(a){var d=$(this).attr("href"),e=$("form .area"),h=$("form button"),k=$("#search #keywords");d==="#2"?(c===!1&&($("#map-bounds").height($("#2").outerHeight()-4),c=!0,i.length===0?navigator.geolocation.watchPosition(function(a){s(a)}):s()),g&&google.maps.event.trigger(g,"resize")):(google.maps.event.trigger(f,"resize"),$("section#welcome").is(":hidden")&&(j===!0||b!=="section#view")&&(w(),j=!1))}),$("body").on("click","a#profile",function(a){$("div.tabbable").hide(),$("div#profile").show(),$("form#profile :input:visible:enabled:first").select().focus(),$("#home form#profile :input").val("")}),$("body").on("click","#home form#profile button#cancel",function(a){$("div#profile").hide(),$("div.tabbable").show(),b==="section#place_locator"&&$("form#search :input:visible:enabled:first").select().focus(),$("#home form#profile :input").val("")}),$("#home form#profile").submit(function(a){a.preventDefault(),k(),$("form#profile").blur(),$.ajax({type:"POST",url:"/profile",dataType:"json",data:{pass_old:$("#home form#profile #pass_old").val(),pass_new:$("#home form#profile #pass_new").val(),pass_retry:$("#home form#profile #pass_retry").val()},error:function(a,b){$("form#profile :input:visible:enabled:first").select().focus()},success:function(a,c,d){$("div#profile").hide(),$("div.tabbable").show(),b==="section#place_locator"&&$("form#search :input:visible:enabled:first").select().focus(),$("#home form#profile :input").val("")},complete:function(a,b){l()}})})})(),function(){p("view"),$(window).resize(function(){$.doTimeout("resize",250,function(){p("view")})}),$("#map").height($("#1").outerHeight()-$("section#view .page-header").outerHeight()-18-6);var b=a;if(b.length>0){var c=b[0].points;if(c.length>0)for(var d=0;d<c.length;d++){var f=c[d],g=new google.maps.LatLng(f.lat,f.lng);i.push(g),e.extend(g)}}}(),function(){f=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e.getCenter(),mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,zoomControl:!0,minZoom:4}),google.maps.event.addListenerOnce(f,"idle",function(){o(i),l()}),h=new google.maps.Polygon({paths:i||[],strokeColor:"#0000FF",strokeOpacity:.6,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.15,clickable:!1}),h.setMap(f)}()}jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(a,b,c,d,e){return jQuery.easing[jQuery.easing.def](a,b,c,d,e)},easeInQuad:function(a,b,c,d,e){return d*(b/=e)*b+c},easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeInOutQuad:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c},easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c},easeInOutCubic:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b+c:d/2*((b-=2)*b*b+2)+c},easeInQuart:function(a,b,c,d,e){return d*(b/=e)*b*b*b+c},easeOutQuart:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},easeInOutQuart:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b+c:-d/2*((b-=2)*b*b*b-2)+c},easeInQuint:function(a,b,c,d,e){return d*(b/=e)*b*b*b*b+c},easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c},easeInOutQuint:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b*b+c:d/2*((b-=2)*b*b*b*b+2)+c},easeInSine:function(a,b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c},easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c},easeInOutSine:function(a,b,c,d,e){return-d/2*(Math.cos(Math.PI*b/e)-1)+c},easeInExpo:function(a,b,c,d,e){return b==0?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){return b==0?c:b==e?c+d:(b/=e/2)<1?d/2*Math.pow(2,10*(b-1))+c:d/2*(-Math.pow(2,-10*--b)+2)+c},easeInCirc:function(a,b,c,d,e){return-d*(Math.sqrt(1-(b/=e)*b)-1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeInOutCirc:function(a,b,c,d,e){return(b/=e/2)<1?-d/2*(Math.sqrt(1-b*b)-1)+c:d/2*(Math.sqrt(1-(b-=2)*b)+1)+c},easeInElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return-(h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g))+c},easeOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*b)*Math.sin((b*e-f)*2*Math.PI/g)+d+c},easeInOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e/2)==2)return c+d;g||(g=e*.3*1.5);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return b<1?-0.5*h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)+c:h*Math.pow(2,-10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)*.5+d+c},easeInBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*(b/=e)*b*((f+1)*b-f)+c},easeOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*((b=b/e-1)*b*((f+1)*b+f)+1)+c},easeInOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),(b/=e/2)<1?d/2*b*b*(((f*=1.525)+1)*b-f)+c:d/2*((b-=2)*b*(((f*=1.525)+1)*b+f)+2)+c},easeInBounce:function(a,b,c,d,e){return d-jQuery.easing.easeOutBounce(a,e-b,0,d,e)+c},easeOutBounce:function(a,b,c,d,e){return(b/=e)<1/2.75?d*7.5625*b*b+c:b<2/2.75?d*(7.5625*(b-=1.5/2.75)*b+.75)+c:b<2.5/2.75?d*(7.5625*(b-=2.25/2.75)*b+.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+.984375)+c},easeInOutBounce:function(a,b,c,d,e){return b<e/2?jQuery.easing.easeInBounce(a,b*2,0,d,e)*.5+c:jQuery.easing.easeOutBounce(a,b*2-e,0,d,e)*.5+d*.5+c}}),function(a){function c(a){return typeof a=="object"?a:{top:a,left:a}}var b=a.scrollTo=function(b,c,d){a(window).scrollTo(b,c,d)};b.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1,limit:!0},b.window=function(b){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!c)return b;var d=(b.contentWindow||b).document||b.ownerDocument||b;return/webkit/i.test(navigator.userAgent)||d.compatMode=="BackCompat"?d.body:d.documentElement})},a.fn.scrollTo=function(d,e,f){return typeof e=="object"&&(f=e,e=0),typeof f=="function"&&(f={onAfter:f}),d=="max"&&(d=9e9),f=a.extend({},b.defaults,f),e=e||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=c(f.offset),f.over=c(f.over),this._scrollable().each(function(){function o(a){j.animate(m,e,f.easing,a&&function(){a.call(this,d,f)})}if(!d)return;var i=this,j=a(i),k=d,l,m={},n=j.is("html,body");switch(typeof k){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(k)){k=c(k);break}k=a(k,this);if(!k.length)return;case"object":if(k.is||k.style)l=(k=a(k)).offset()}a.each(f.axis.split(""),function(a,c){var d=c=="x"?"Left":"Top",e=d.toLowerCase(),p="scroll"+d,q=i[p],r=b.max(i,c);if(l)m[p]=l[e]+(n?0:q-j.offset()[e]),f.margin&&(m[p]-=parseInt(k.css("margin"+d))||0,m[p]-=parseInt(k.css("border"+d+"Width"))||0),m[p]+=f.offset[e]||0,f.over[e]&&(m[p]+=k[c=="x"?"width":"height"]()*f.over[e]);else{var s=k[e];m[p]=s.slice&&s.slice(-1)=="%"?parseFloat(s)/100*r:s}f.limit&&/^\d+$/.test(m[p])&&(m[p]=m[p]<=0?0:Math.min(m[p],r)),!a&&f.queue&&(q!=m[p]&&o(f.onAfterFirst),delete m[p])}),o(f.onAfter)}).end()},b.max=function(b,c){var d=c=="x"?"Width":"Height",e="scroll"+d;if(!a(b).is("html,body"))return b[e]-a(b)[d.toLowerCase()]();var f="client"+d,g=b.ownerDocument.documentElement,h=b.ownerDocument.body;return Math.max(g[e],h[e])-Math.min(g[f],h[f])}}(jQuery),function(a){if(a)return;var b;a=window.navigator.geolocation={},a.getCurrentPosition=function(a){b&&a(b),$.getScript("//www.google.com/jsapi",function(){google.loader.ClientLocation&&(b={coords:{latitude:google.loader.ClientLocation.latitude,longitude:google.loader.ClientLocation.longitude}}),a(b)})},a.watchPosition=a.getCurrentPosition}(navigator.geolocation);